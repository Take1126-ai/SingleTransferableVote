# STV選挙シミュレーター（ミーク法準拠）

## 1. 概要

単記移譲式投票（STV）の選挙をシミュレートするコマンドラインツールです。

特に、本プログラムは選挙規約で定められた**ミーク法（Meek's Method）**に基づき、票の価値を反復計算で厳密に処理するアルゴリズムを実装しています。ドループ基数は選挙の最初に一度だけ計算され、選挙を通じて固定値として扱われます。

## 2. 主な機能

- 某会の選挙規約に準拠した、ミーク法によるSTV集計ロジック
- ファイルからの投票データ読み込み
- コマンドライン引数による柔軟な選挙設定
- 詳細な途中経過を出力する冗長モード（`--verbose`）

## 3. 動作要件

- Python 3.6以上
- 外部ライブラリは不要です。標準ライブラリのみで動作します。

## 4. 使い方

ターミナルから `main.py` を実行します。

### コマンドライン構文

```bash
python3 /path/to/src/python/main.py --filepath <投票データファイル> --candidates <候補者文字列> --num_winners <当選者数> [--verbose]
```

### 引数の説明

- `--filepath` (必須): 投票データが記述されたテキストファイルのパス。
- `--candidates` (必須): 有効な候補者をすべて含む文字列（例: `"ABCDEF"`）。
- `--num_winners` (必須): 当選者の数（当選枠）。
- `--verbose` (任意): このフラグを付けると、各ラウンドの計算過程が詳細に出力されます。

### 実行例

```bash
python3 /home/testtest/stv/src/python/main.py --filepath /home/testtest/stv/docs/test_votedata.txt --candidates "ABCDEF" --num_winners 3 --verbose
```

## 5. 投票データファイルの形式

- 1行に1票を記述します。
- 各行は、候補者を示す文字を優先順位に従って並べた文字列です。
- 例: `ACBE` は、1位=A, 2位=C, 3位=B, 4位=E の投票を意味します。
- ファイル内に空行や、候補者以外の文字・重複した文字を含む行は無効票として無視されます。

## 6. プロジェクト構成

```
├── src/
│   └── python/
│       ├── main.py             # エントリーポイント、引数解析
│       └── stv_election.py     # STV選挙のコアロジック
├── docs/
│   ├── design_specification.md # 設計書
│   └── ...                   # テストデータなど
└── README.md                   # このファイル
```

## 7. 実行結果の例

以下は、`--verbose`フラグを付けてテストデータで実行した際の出力例です。

```
選挙プロセスを開始します...
50件の有効票を読み込みました。
当選基数（ドループ基数）: 13

--- ラウンド 1 ---
  --- 反復計算 開始時 --- 
    A: 0.0000 (活動中) [保有率: 1.0000]
    B: 0.0000 (活動中) [保有率: 1.0000]
    C: 0.0000 (活動中) [保有率: 1.0000]
    D: 0.0000 (活動中) [保有率: 1.0000]
    E: 0.0000 (活動中) [保有率: 1.0000]
    F: 0.0000 (活動中) [保有率: 1.0000]
  [反復 1] 保有率変動: 0.368627
  [反復 2] 保有率変動: 0.162663
  ...
  [反復 20] 保有率変動: 0.000000
  保有率が収束しました。
  --- 反復計算 終了時 --- 
    A: 13.0000 (活動中) [保有率: 0.6733]
    B: 13.0000 (活動中) [保有率: 0.7117]
    C: 7.8391 (活動中) [保有率: 1.0000]
    D: 8.2883 (活動中) [保有率: 1.0000]
    E: 2.8534 (活動中) [保有率: 1.0000]
    F: 2.4767 (活動中) [保有率: 1.0000]
落選: F (得票数: 2.4767) - 最下位

--- ラウンド 2 ---
  ...
  --- 反復計算 終了時 --- 
    A: 13.0000 (活動中) [保有率: 0.6125]
    B: 13.0000 (活動中) [保有率: 0.6416]
    C: 8.5740 (活動中) [保有率: 1.0000]
    D: 8.3584 (活動中) [保有率: 1.0000]
    E: 3.6892 (活動中) [保有率: 1.0000]
    F: 0.0000 (落選) [保有率: 0.0000]
落選: E (得票数: 3.6892) - 最下位

--- ラウンド 3 ---
  ...
  --- 反復計算 終了時 --- 
    A: 13.0000 (活動中) [保有率: 0.5332]
    B: 13.0000 (活動中) [保有率: 0.6018]
    C: 9.4977 (活動中) [保有率: 1.0000]
    D: 8.9558 (活動中) [保有率: 1.0000]
    E: 0.0000 (落選) [保有率: 0.0000]
    F: 0.0000 (落選) [保有率: 0.0000]
落選: D (得票数: 8.9558) - 最下位

--- 最終ラウンド: 4 ---
  ...
  --- 反復計算 終了時 --- 
    A: 13.0000 (活動中) [保有率: 0.4195]
    B: 13.0000 (活動中) [保有率: 0.4622]
    C: 11.8528 (活動中) [保有率: 1.0000]
    D: 0.0000 (落選) [保有率: 0.0000]
    E: 0.0000 (落選) [保有率: 0.0000]
    F: 0.0000 (落選) [保有率: 0.0000]

選挙の勝者が確定しました。

--- 選挙結果 ---
当選者 (2名):
  - A
  - B

最終状況:
  - A: 13.0000 (当選) 
  - B: 13.0000 (当選) 
  - C: 11.8528 (落選) 
  - D: 0.0000 (落選) 
  - E: 0.0000 (落選) 
  - F: 0.0000 (落選) 
```
